{{define "header"}}
<header class="bg-slate-900 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <a href="/" class="text-xl font-bold text-white">Skalkaho</a>
            <nav class="flex items-center gap-6">
                <a href="/" class="text-slate-300 hover:text-white transition-colors">Quotes</a>
                <a href="/settings" class="text-slate-300 hover:text-white transition-colors">Settings</a>
            </nav>
        </div>
    </div>
</header>
{{end}}

{{define "head"}}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skalkaho - Construction Quoting</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
    theme: {
        extend: {
            colors: {
                slate: {
                    50: '#f4f5f7',
                    100: '#e8ebef',
                    300: '#b0b8c4',
                    500: '#64707d',
                    700: '#3d4450',
                    900: '#1a1d23',
                },
                forest: {
                    50: '#eef5f2',
                    100: '#d4e8df',
                    300: '#7fb09a',
                    500: '#3d7a5f',
                    700: '#2d5a47',
                    900: '#1a332a',
                },
                copper: {
                    50: '#faf3ec',
                    100: '#f5e0ce',
                    300: '#e0a879',
                    500: '#c97a42',
                    700: '#a35a2a',
                    900: '#6b3d1f',
                },
                success: {
                    100: '#d8f3dc',
                    500: '#40916c',
                    700: '#2d6a4f',
                },
                warning: {
                    100: '#fff3cd',
                    500: '#e09200',
                    700: '#b86e00',
                },
                error: {
                    100: '#fce8e8',
                    500: '#dc3c3c',
                    700: '#b42a2a',
                },
                info: {
                    100: '#e3f2fc',
                    500: '#4a90c2',
                    700: '#2a6496',
                },
            },
        },
    },
}
</script>
<script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<style>
    [x-cloak] { display: none !important; }
    /* Details arrow rotation */
    details[open] > summary .details-arrow { transform: rotate(90deg); }
    details > summary::-webkit-details-marker { display: none; }
</style>
{{end}}

{{define "toast"}}
<div x-data="toastManager()"
     @show-toast.window="addToast($event.detail)"
     class="fixed bottom-4 right-4 z-50 flex flex-col gap-2">
    <template x-for="toast in toasts" :key="toast.id">
        <div x-show="toast.visible"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-x-4"
             x-transition:enter-end="opacity-100 transform translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="px-4 py-3 rounded-lg shadow-lg"
             :class="{
                 'bg-success-700 text-white': toast.type === 'success',
                 'bg-error-700 text-white': toast.type === 'error',
                 'bg-info-700 text-white': toast.type === 'info'
             }">
            <span x-text="toast.message"></span>
        </div>
    </template>
</div>
<script>
function toastManager() {
    return {
        toasts: [],
        addToast(detail) {
            const id = Date.now();
            this.toasts.push({ id, ...detail, visible: true });
            setTimeout(() => this.removeToast(id), 3000);
        },
        removeToast(id) {
            const toast = this.toasts.find(t => t.id === id);
            if (toast) toast.visible = false;
            setTimeout(() => {
                this.toasts = this.toasts.filter(t => t.id !== id);
            }, 300);
        }
    };
}

// Item template autocomplete selection
function selectItem(button) {
    const form = button.closest('form');
    if (!form) return;

    // Populate form fields from data attributes
    const nameInput = form.querySelector('input[name="name"]');
    const typeSelect = form.querySelector('select[name="type"]');
    const unitInput = form.querySelector('input[name="unit"]');
    const priceInput = form.querySelector('input[name="unit_price"]');

    if (nameInput) nameInput.value = button.dataset.name || '';
    if (typeSelect) typeSelect.value = button.dataset.type || 'material';
    if (unitInput) unitInput.value = button.dataset.unit || '';
    if (priceInput) priceInput.value = button.dataset.price || '0';

    // Clear search results
    const searchResults = form.querySelector('.search-results');
    if (searchResults) searchResults.innerHTML = '';
}
</script>
{{end}}
