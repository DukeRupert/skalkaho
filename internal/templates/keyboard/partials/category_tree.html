{{define "category_tree"}}
<div class="bg-white rounded-lg border border-slate-200 p-3">
    <div class="flex items-center gap-2 mb-3 pb-2 border-b border-slate-100">
        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
        </svg>
        <span class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Structure</span>
    </div>
    {{if .CategoryTree}}
    <ul class="space-y-1 text-sm">
        {{range .CategoryTree}}
        {{template "tree_node" (dict "Node" . "CurrentID" $.CurrentCategoryID "Depth" 0)}}
        {{end}}
    </ul>
    {{else}}
    <p class="text-xs text-slate-400 text-center py-2">No categories yet</p>
    {{end}}
</div>
{{end}}

{{define "tree_node"}}
{{$isActive := eq .Node.ID .CurrentID}}
{{$hasChildren := gt (len .Node.Children) 0}}
<li>
    <a href="/categories/{{.Node.ID}}"
       class="flex items-center gap-1.5 px-2 py-1 rounded transition-colors
              {{if $isActive}}bg-slate-900 text-white{{else}}text-slate-700 hover:bg-slate-100{{end}}">
        {{if eq .Depth 0}}
        <svg class="w-3 h-3 shrink-0 {{if $isActive}}text-white{{else}}text-forest-600{{end}}" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
        </svg>
        {{else}}
        <svg class="w-3 h-3 shrink-0 {{if $isActive}}text-white{{else}}text-slate-400{{end}}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        {{end}}
        <span class="truncate">{{.Node.Name}}</span>
    </a>
    {{if $hasChildren}}
    <ul class="ml-3 mt-1 space-y-1 border-l border-slate-200 pl-2">
        {{$currentID := .CurrentID}}
        {{$newDepth := add .Depth 1}}
        {{range .Node.Children}}
        {{template "tree_node" (dict "Node" . "CurrentID" $currentID "Depth" $newDepth)}}
        {{end}}
    </ul>
    {{end}}
</li>
{{end}}
